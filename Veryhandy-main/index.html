<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="cYHi8vUq31lpMvwET--fYXT9bWCoUluJzB4LBIscM_U" />
    <title>VeryHandy Home Service Inc. | Reliable Handyman Services</title>
    <link rel="canonical" href="https://veryhandyhomeservice.com/" />
    <meta name="description"
        content="VeryHandy Home Service Inc. provides professional handyman services including drywall repair, painting, flooring, and furniture assembly. Reliable quality you can trust.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <style>
        .iti {
            width: 100%;
        }

        .iti__flag-container {
            border-radius: 12px 0 0 12px;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
        }

        #hero {
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('image/background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #000000;
        }

        .text-shadow {
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.9), 0 0 10px rgba(0, 0, 0, 0.7);
        }

        .max-logo {
            height: 80px;
            width: auto;
            display: block;
        }

        #lightbox-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
        }

        #lightbox-modal.active {
            display: flex;
        }

        #view-login.active {
            display: flex;
            position: fixed;
            inset: 0;
            z-index: 100;
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
        }

        .auth-card {
            background: white;
            border-radius: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from {
                transform: translateY(40px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes pulse-blue {
            0% {
                box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7);
            }

            70% {
                box-shadow: 0 0 0 15px rgba(37, 99, 235, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(37, 99, 235, 0);
            }
        }

        .btn-pulse {
            animation: pulse-blue 2s infinite;
        }

        .service-card {
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .service-card:hover {
            transform: translateY(-12px) scale(1.02) rotate(1deg);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: #2563eb;
        }

        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #hero h1 {
            animation: fadeInDown 1s both;
        }

        #hero p {
            animation: fadeInUp 1s 0.3s both;
        }

        #hero .cta-buttons {
            animation: fadeInUp 1s 0.6s both;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-link-hover {
            position: relative;
        }

        .nav-link-hover::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background-color: #2563eb;
            transition: width 0.3s ease;
        }

        .nav-link-hover:hover::after {
            width: 100%;
        }

        .pagination-btn {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-weight: 900;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border: 2px solid #e2e8f0;
            color: #64748b;
        }

        .pagination-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.25);
            transform: translateY(-2px);
        }

        .pagination-btn:hover:not(.active) {
            background: #f8fafc;
            border-color: #cbd5e1;
            color: #1e293b;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
        }

        .text-glow {
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        /* Custom Alert Transitions */
        #custom-alert {
            transition: opacity 0.3s ease;
        }

        #custom-alert-content {
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 overflow-x-hidden font-sans">

    <div id="lightbox-modal" onclick="closeLightbox()">
        <span
            class="absolute top-5 right-10 text-white text-5xl font-bold cursor-pointer hover:text-blue-500 transition">&times;</span>
        <img id="lightbox-img" src="" class="max-h-[85vh] max-w-[90vw] rounded-lg shadow-2xl border-4 border-white/10">
    </div>

    <!-- Custom Alert Modal (Moved to top for reliable DOM access) -->
    <div id="custom-alert"
        class="fixed inset-0 z-[100] hidden pointer-events-none items-center justify-center bg-slate-900/60 backdrop-blur-sm opacity-0 px-4"
        onclick="if(event.target === this) closeCustomAlert()">
        <div class="bg-white rounded-[32px] shadow-2xl max-w-sm w-full p-8 transform scale-95 relative overflow-hidden ring-1 ring-white/20"
            id="custom-alert-content">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-red-500 to-pink-500" id="alert-bar">
            </div>
            <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-red-50 mb-6 shadow-inner ring-4 ring-red-500/5 transition-colors duration-300"
                    id="alert-icon-bg">
                    <i class="fa-solid fa-triangle-exclamation text-3xl text-red-500 transition-colors duration-300"
                        id="alert-icon"></i>
                </div>
                <h3 class="text-xl font-black text-slate-800 uppercase tracking-tight mb-3" id="alert-title">Access
                    Denied</h3>
                <p class="text-sm text-slate-500 font-bold leading-relaxed mb-8" id="alert-message">Please check your
                    input.</p>
                <button onclick="closeCustomAlert()"
                    class="w-full bg-slate-900 text-white font-black py-4 rounded-2xl shadow-xl hover:bg-blue-600 transition-all transform hover:-translate-y-1 uppercase text-[10px] tracking-[0.2em] relative overflow-hidden group">
                    <span class="relative z-10">Dismiss</span>
                    <div
                        class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                    </div>
                </button>
            </div>
        </div>
    </div>

    <nav class="glass fixed w-full z-50 border-b border-slate-200 px-4 md:px-6 py-2 flex justify-between items-center">
        <div class="flex items-center space-x-2 md:space-x-4 cursor-pointer" onclick="showView('landing')">
            <img src="image/logo/logo.svg" alt="Logo" class="h-12 md:max-logo">
            <div
                class="text-xl md:text-2xl font-black text-blue-600 tracking-tighter uppercase whitespace-nowrap overflow-hidden text-ellipsis max-w-[150px] md:max-w-none">
                <span class="hidden md:inline">VeryHandy Solution, Inc.</span>
                <span class="md:hidden">VeryHandy Solution</span>
            </div>
        </div>
        <div class="flex space-x-2 md:space-x-4">
            <button onclick="showView('login')"
                class="bg-blue-600 text-white px-4 md:px-6 py-2 rounded-full text-xs md:text-sm font-bold shadow-lg hover:bg-blue-700 transition uppercase tracking-widest hover:scale-105">Login</button>
        </div>
    </nav>

    <section id="view-landing" class="view active">
        <div id="hero" class="h-screen relative flex items-center justify-center text-center px-4 md:px-6">
            <div class="max-w-4xl text-white z-10">
                <h1
                    class="text-4xl sm:text-5xl md:text-8xl font-black leading-tight mb-6 text-shadow uppercase tracking-tighter">
                    Fix it with <br>
                    <span class="text-blue-500">VeryHandy Solution</span>
                </h1>
                <p
                    class="animate-float text-lg md:text-2xl text-slate-100 mb-8 md:mb-10 font-bold text-shadow tracking-wide">
                    Your Trusted Local Handyman
                </p>
                <div class="cta-buttons flex flex-col sm:flex-row justify-center gap-3 md:gap-4">
                    <button onclick="document.getElementById('expert-services').scrollIntoView({behavior:'smooth'})"
                        class="bg-white text-blue-600 px-8 md:px-10 py-3 md:py-4 rounded-xl md:rounded-2xl font-black text-lg md:text-xl shadow-xl hover:bg-slate-100 transition">Our
                        Services</button>
                    <button onclick="showView('login')"
                        class="btn-pulse bg-blue-600 hover:bg-blue-700 px-8 md:px-10 py-3 md:py-4 rounded-xl md:rounded-2xl font-black text-lg md:text-xl shadow-xl transition transform hover:scale-105">Book
                        Now</button>
                </div>
            </div>
        </div>

        <div class="bg-white py-32 px-6 text-center border-b border-slate-100 overflow-hidden relative">
            <div
                class="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[300px] bg-blue-50/50 blur-[120px] rounded-full -z-10">
            </div>
            <div class="max-w-6xl mx-auto" data-aos="fade-up">
                <h2
                    class="text-4xl md:text-6xl font-black text-slate-900 mb-10 uppercase tracking-tighter leading-tight">
                    Reliable
                    Quality You Can <span
                        class="bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">Trust</span>
                </h2>
                <p class="text-xl md:text-2xl text-slate-500 leading-relaxed mb-12 max-w-4xl mx-auto font-medium">
                    At <span class="font-black text-blue-600 uppercase tracking-tight">VeryHandy Solution, Inc.</span>,
                    we offer a
                    comprehensive range of professional handyman services to keep your home in top condition. Our
                    skilled team
                    delivers high-quality results with exceptional customer service and attention to detail.
                </p>
                <div class="flex justify-center gap-8 md:gap-16 flex-wrap">
                    <div class="flex flex-col items-center">
                        <span class="text-4xl md:text-5xl font-black text-slate-800">100%</span>
                        <span
                            class="text-xs uppercase font-bold text-slate-400 tracking-widest mt-2">Satisfaction</span>
                    </div>

                    <div class="flex flex-col items-center">
                        <span class="text-4xl md:text-5xl font-black text-slate-800">Expert</span>
                        <span
                            class="text-xs uppercase font-bold text-slate-400 tracking-widest mt-2">Craftsmanship</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="expert-services" class="bg-slate-50 py-24 px-6">
            <div class="max-w-7xl mx-auto">
                <h2 data-aos="fade-up"
                    class="text-4xl font-black text-center mb-16 uppercase tracking-widest text-slate-800 underline decoration-blue-600 decoration-8 underline-offset-8">
                    Expert Handyman Services</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="service-card bg-white p-8 rounded-3xl shadow-sm border border-slate-200"
                        data-aos="fade-up" data-aos-delay="100">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Drywall Repair and Maintenance</h3>
                        <p class="text-slate-600 text-sm">We repair cracks, holes, and dents in drywall, ensuring your
                            walls look smooth and flawless.</p>
                    </div>
                    <div class="service-card bg-white p-8 rounded-3xl shadow-sm border border-slate-200"
                        data-aos="fade-up" data-aos-delay="200">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Interior Stain and Paint</h3>
                        <p class="text-slate-600 text-sm">Give your interiors a fresh new look with our professional
                            staining and painting services.</p>
                    </div>
                    <div class="service-card bg-white p-8 rounded-3xl shadow-sm border border-slate-200"
                        data-aos="fade-up" data-aos-delay="300">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Exterior Stain and Paint</h3>
                        <p class="text-slate-600 text-sm">Enhance your home’s curb appeal with durable and high-quality
                            exterior staining and painting.</p>
                    </div>
                    <div class="service-card bg-white p-8 rounded-3xl shadow-sm border border-slate-200"
                        data-aos="fade-up" data-aos-delay="200">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Floor Improvements and Tiling</h3>
                        <p class="text-slate-600 text-sm">Professional installation and repair for all types of
                            flooring, including tile, laminate, and hardwood.</p>
                    </div>
                    <div class="service-card bg-white p-8 rounded-3xl shadow-sm border border-slate-200"
                        data-aos="fade-up" data-aos-delay="300">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Furniture Assembly</h3>
                        <p class="text-slate-600 text-sm">Expert assembly for all types of furniture, including desks,
                            bookshelves, and bed frames.</p>
                    </div>
                    <div class="service-card bg-white p-8 rounded-3xl shadow-sm border border-slate-200"
                        data-aos="fade-up" data-aos-delay="400">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Light Fixture Installation</h3>
                        <p class="text-slate-600 text-sm">We safely install new light fixtures to brighten and elevate
                            your spaces.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white py-24 px-6 border-y border-slate-200">
            <div class="max-w-7xl mx-auto">
                <h2
                    class="text-4xl font-black text-center mb-16 uppercase tracking-widest text-slate-800 underline decoration-blue-600 decoration-8 underline-offset-8">
                    Professional Handyman Services</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-slate-50 p-8 rounded-3xl shadow-sm border border-slate-200">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Door Hardware Installation</h3>
                        <p class="text-slate-600 text-sm">Secure and refresh your doors with our professional hardware
                            installation services.</p>
                    </div>
                    <div class="bg-slate-50 p-8 rounded-3xl shadow-sm border border-slate-200">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Picture Hanging and Installation</h3>
                        <p class="text-slate-600 text-sm">We hang pictures, mirrors, and artwork securely and perfectly
                            aligned.</p>
                    </div>
                    <div class="bg-slate-50 p-8 rounded-3xl shadow-sm border border-slate-200">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Window Coverings</h3>
                        <p class="text-slate-600 text-sm">Professional installation of blinds, curtains, and shades to
                            suit your style and needs.</p>
                    </div>
                    <div class="bg-slate-50 p-8 rounded-3xl shadow-sm border border-slate-200">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase">Screen Installation and Repair</h3>
                        <p class="text-slate-600 text-sm">We install or repair window and door screens to keep bugs out
                            and comfort in.</p>
                    </div>
                    <div class="bg-slate-50 p-8 rounded-3xl shadow-sm border border-slate-200">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase tracking-tight">Small Appliance
                            Installation</h3>
                        <p class="text-slate-600 text-sm">Quick and reliable installation and repair of small household
                            appliances.</p>
                    </div>
                    <div class="bg-slate-50 p-8 rounded-3xl shadow-sm border border-slate-200">
                        <h3 class="text-xl font-bold mb-4 text-blue-600 uppercase tracking-tight">Smart Home Upgrades
                        </h3>
                        <p class="text-slate-600 text-sm">Modernize your home with smart device installations for
                            convenience and efficiency.</p>
                    </div>

                </div>
            </div>
        </div>

        <section id="recent-projects" class="py-24 bg-slate-50 relative overflow-hidden">
            <div class="container mx-auto px-6 relative z-10">
                <div class="text-center mb-16" data-aos="fade-up">
                    <span
                        class="inline-block px-4 py-1.5 rounded-full bg-blue-100 text-blue-600 font-black text-[10px] uppercase tracking-[0.3em] mb-4">Portfolio</span>
                    <h2 class="text-5xl font-black text-slate-800 uppercase tracking-tighter mb-6">Recent Work Mastery
                    </h2>
                    <p class="text-slate-500 text-lg max-w-2xl mx-auto font-medium leading-relaxed">Explore our latest
                        successful transformations and maintenance projects across the region.</p>
                </div>

                <div id="project-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                </div>

                <div id="project-pagination" class="flex justify-center items-center gap-3 mt-16" data-aos="fade-up">
                </div>
            </div>
        </section>

        <section id="testimonials" class="py-24 bg-white border-t border-slate-100">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16" data-aos="fade-up">
                    <span
                        class="inline-block px-4 py-1.5 rounded-full bg-blue-100 text-blue-600 font-black text-[10px] uppercase tracking-[0.3em] mb-4 border border-blue-200">Reviews</span>
                    <h2 class="text-4xl font-black text-slate-800 uppercase tracking-tighter">Client Satisfaction</h2>
                </div>
                <div id="testimonials-container" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                </div>
            </div>
        </section>
    </section>

    <!-- Auth Section -->
    <section id="view-login" class="view" onclick="showView('landing')">
        <div class="auth-card w-full max-w-md p-6 md:p-8 relative max-h-[90vh] overflow-y-auto"
            onclick="event.stopPropagation()">
            <button onclick="showView('landing')"
                class="absolute top-6 right-6 text-slate-300 hover:text-blue-600 transition text-3xl font-light">&times;</button>

            <!-- Sign In Form -->
            <div id="form-signin" class="space-y-6">
                <div class="flex border-b border-slate-100 mb-8">
                    <button onclick="toggleAuthMode('signin')"
                        class="flex-1 pb-4 text-xs font-black uppercase tracking-[0.2em] border-b-2 border-blue-600 text-blue-600">Sign
                        In</button>
                    <button onclick="toggleAuthMode('signup')"
                        class="flex-1 pb-4 text-xs font-black uppercase tracking-[0.2em] border-b-2 border-transparent text-slate-400">Sign
                        Up</button>
                </div>
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight">Welcome Back</h2>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Access your account
                    </p>
                </div>
                <form onsubmit="handleSignin(event)" class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Email
                            Address</label>
                        <input type="email" id="signin-email" required
                            class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Security
                            Password</label>
                        <div class="relative">
                            <input type="password" id="signin-password" required
                                class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                            <button type="button" onclick="togglePasswordVisibility('signin-password')"
                                class="absolute right-6 top-1/2 -translate-y-1/2 text-slate-300 hover:text-blue-600 transition">
                                <i class="fa-solid fa-eye text-sm"></i>
                            </button>
                        </div>
                    </div>
                    <button type="submit" id="signin-btn"
                        class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-500/20 hover:bg-slate-900 transition-all transform hover:-translate-y-1 uppercase text-[10px] tracking-[0.2em]">
                        Establish Connection
                    </button>
                </form>
                <div class="text-center pt-4">
                    <button onclick="toggleAuthMode('forgot')"
                        class="text-[10px] font-black text-blue-600 uppercase tracking-widest hover:underline">Trouble
                        Signing In?</button>
                </div>
            </div>

            <!-- Sign Up Form -->
            <div id="form-signup" class="space-y-6 hidden">
                <div class="flex border-b border-slate-100 mb-8">
                    <button onclick="toggleAuthMode('signin')"
                        class="flex-1 pb-4 text-xs font-black uppercase tracking-[0.2em] border-b-2 border-transparent text-slate-400">Sign
                        In</button>
                    <button onclick="toggleAuthMode('signup')"
                        class="flex-1 pb-4 text-xs font-black uppercase tracking-[0.2em] border-b-2 border-blue-600 text-blue-600">Sign
                        Up</button>
                </div>
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight">New Account</h2>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Join VeryHandy
                        Solution</p>
                </div>
                <form id="signup-form" onsubmit="handleSignup(event)" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Full
                                Name</label>
                            <input type="text" id="signup-name" required
                                class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Email
                                Address</label>
                            <input type="email" id="signup-email" required
                                class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label
                                class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Password</label>
                            <input type="password" id="signup-password" required
                                class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Mobile
                                Number</label>
                            <input type="tel" id="signup-mobile" required
                                class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-1">
                            <label
                                class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Address</label>
                            <input type="text" id="signup-address" required
                                class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                        </div>
                        <div class="space-y-1">
                            <label
                                class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Age</label>
                            <input type="number" id="signup-age" required
                                class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                        </div>
                    </div>
                    <button type="submit" id="signup-btn"
                        class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-500/20 hover:bg-slate-900 transition-all transform hover:-translate-y-1 uppercase text-[10px] tracking-[0.2em] mt-4">
                        Initialize Account
                    </button>
                </form>
            </div>

            <!-- OTP Verification View -->
            <div id="view-otp" class="space-y-8 py-4 hidden">
                <div class="text-center">
                    <div
                        class="w-16 h-16 bg-blue-50 rounded-3xl flex items-center justify-center text-blue-600 mx-auto mb-6 shadow-lg shadow-blue-500/10">
                        <i class="fa-solid fa-envelope-open-text text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight">Verify Identity</h2>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-2 px-6">We've sent a
                        6-digit code to <br><span id="pending-email" class="text-blue-600 lowercase font-black"></span>
                    </p>
                    <button onclick="changeSignupEmail()"
                        class="text-[9px] text-slate-400 font-bold hover:text-blue-600 underline mt-2 cursor-pointer uppercase tracking-widest">Wrong
                        Email Address?</button>
                </div>
                <div class="grid grid-cols-6 gap-2" id="otp-input-group">
                    <input type="text" maxlength="1"
                        class="otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                </div>
                <button onclick="verifySignupOtp()" id="otp-btn"
                    class="w-full bg-slate-900 text-white font-black py-5 rounded-2xl shadow-xl transition-all transform hover:scale-[1.02] active:scale-[0.98] uppercase text-[10px] tracking-[0.2em] mt-4">
                    Confirm Verification
                </button>
                <div class="text-center">
                    <button onclick="resendSignupOtp()"
                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-blue-600 transition">Code
                        not received? Resend Email</button>
                </div>
            </div>

            <!-- Forgot Password Form -->
            <div id="form-forgot" class="space-y-6 hidden">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight">Identity Recovery</h2>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Regain access to your
                        account</p>
                </div>
                <form id="forgot-password-form" onsubmit="handleForgotPassword(event)" class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Registered
                            Email</label>
                        <input type="email" id="forgot-email" required
                            class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                    </div>
                    <button type="submit" id="forgot-btn"
                        class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-500/20 hover:bg-slate-900 transition-all transform hover:-translate-y-1 uppercase text-[10px] tracking-[0.2em]">
                        Begin Recovery
                    </button>
                </form>
                <div class="text-center">
                    <button onclick="toggleAuthMode('signin')"
                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-blue-600 transition">Return
                        to Sign In</button>
                </div>
            </div>

            <!-- Reset OTP View -->
            <div id="view-reset-otp" class="space-y-8 py-4 hidden">
                <div class="text-center">
                    <div
                        class="w-16 h-16 bg-blue-50 rounded-3xl flex items-center justify-center text-blue-600 mx-auto mb-6 shadow-lg shadow-blue-500/10">
                        <i class="fa-solid fa-key text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight">Security Code</h2>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-2 px-6">Enter the
                        recovery
                        code sent to <br><span id="pending-reset-email"
                            class="text-blue-600 lowercase font-black"></span></p>
                </div>
                <div class="grid grid-cols-6 gap-2" id="reset-otp-input-group">
                    <input type="text" maxlength="1"
                        class="reset-otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="reset-otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="reset-otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="reset-otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="reset-otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                    <input type="text" maxlength="1"
                        class="reset-otp-field w-full aspect-square text-center font-black text-xl bg-slate-50 border border-slate-100 rounded-xl outline-none focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 transition-all">
                </div>
                <button onclick="verifyResetOtp()" id="reset-otp-btn"
                    class="w-full bg-slate-900 text-white font-black py-5 rounded-2xl shadow-xl transition-all transform hover:scale-[1.02] active:scale-[0.98] uppercase text-[10px] tracking-[0.2em] mt-4">
                    Verify & Reset
                </button>
                <div class="text-center">
                    <button onclick="resendResetOtp()" id="resend-reset-btn"
                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest hover:text-blue-600 transition">Problem?
                        Request New Code</button>
                </div>
            </div>

            <!-- Update Password Form -->
            <div id="form-update" class="space-y-6 hidden">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tight">Security Upgrade</h2>
                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Define your new
                        password</p>
                </div>
                <form id="update-password-form" onsubmit="handleUpdatePassword(event)" class="space-y-4">
                    <div class="space-y-1">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">New Secure
                            Password</label>
                        <input type="password" id="update-password" required
                            class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Confirm
                            Password</label>
                        <input type="password" id="update-password-confirm" required
                            class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl outline-none focus:ring-4 focus:ring-blue-500/5 focus:bg-white focus:border-blue-500 transition-all font-bold text-sm">
                    </div>
                    <button type="submit" id="update-btn"
                        class="w-full bg-blue-600 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-500/20 hover:bg-slate-900 transition-all transform hover:-translate-y-1 uppercase text-[10px] tracking-[0.2em]">
                        Apply Changes
                    </button>
                </form>
            </div>
        </div>
    </section>

    <footer class="bg-slate-900 text-slate-400 py-16 text-center">
        <div class="max-w-4xl mx-auto px-6">
            <div class="w-24 mx-auto mb-6"><img src="image/logo/logo.svg" alt="Logo" class="w-full"></div>
            <h2 class="text-white text-2xl font-black mb-4 uppercase">VeryHandy Solution, Inc.</h2>
            <p class="mb-4 text-sm">Thank you for visiting VeryHandy Solution! We are dedicated to providing
                quality craftsmanship and exceptional customer service.</p>
            <p class="text-xs tracking-widest uppercase">&copy; 2026 All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        // --- SUPABASE CONFIG ---
        const SUPABASE_URL = 'https://qakgewjfhemqgxxfcdvi.supabase.co'.trim();
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFha2dld2pmaGVtcWd4eGZjZHZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3ODk5MTcsImV4cCI6MjA4NDM2NTkxN30.JIcu_7Veehn370s6e0L60R5gtGKQG7ZmVwnOpKREXlo'.trim();
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- CUSTOM ALERT LOGIC ---
        function showAlert(title, message, type = 'error') {
            const modal = document.getElementById('custom-alert');
            const container = document.getElementById('custom-alert-content');
            const alertTitle = document.getElementById('alert-title');
            const alertMsg = document.getElementById('alert-message');
            const iconBg = document.getElementById('alert-icon-bg');
            const bar = document.getElementById('alert-bar');

            if (!modal) {
                console.error("Alert Modal Missing in DOM");
                alert(title + "\n" + message); // Fallback to native alert
                return;
            }

            if (alertTitle) alertTitle.textContent = title;
            if (alertMsg) alertMsg.textContent = message;

            modal.classList.remove('hidden');
            // Force reflow
            void modal.offsetWidth;
            modal.classList.remove('opacity-0');

            if (container) {
                container.classList.remove('scale-95');
                container.classList.add('scale-100');
            }

            if (iconBg) {
                if (type === 'success') {
                    iconBg.className = 'mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-green-50 mb-6 shadow-inner ring-4 ring-green-500/5';
                    iconBg.innerHTML = '<i class="fa-solid fa-check text-3xl text-green-500"></i>';
                    if (alertTitle) alertTitle.className = 'text-xl font-black text-slate-800 uppercase tracking-tight mb-3 text-green-600';
                    if (bar) bar.className = 'absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-green-400 to-emerald-500';
                } else {
                    iconBg.className = 'mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-red-50 mb-6 shadow-inner ring-4 ring-red-500/5';
                    iconBg.innerHTML = '<i class="fa-solid fa-triangle-exclamation text-3xl text-red-500"></i>';
                    if (alertTitle) alertTitle.className = 'text-xl font-black text-slate-800 uppercase tracking-tight mb-3 text-red-600';
                    if (bar) bar.className = 'absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-red-500 to-pink-500';
                }
            } else {
                console.warn("Alert Icon Element missing");
            }
        }

        function closeCustomAlert() {
            const modal = document.getElementById('custom-alert');
            const container = document.getElementById('custom-alert-content');
            if (!modal) return;

            modal.classList.add('opacity-0');
            if (container) {
                container.classList.add('scale-95');
                container.classList.remove('scale-100');
            }

            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        // --- MOBILE INPUT INIT ---
        const mobileInput = document.querySelector("#signup-mobile");
        const iti = window.intlTelInput(mobileInput, {
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
            preferredCountries: ["ph", "us", "gb"],
            separateDialCode: true
        });

        // OTP Auto-focus logic
        function setupOtpAutoFocus(fieldsClass) {
            const fields = document.querySelectorAll(fieldsClass);
            fields.forEach((field, index) => {
                field.addEventListener('input', (e) => {
                    if (e.target.value.length === 1 && index < fields.length - 1) {
                        fields[index + 1].focus();
                    }
                });
                field.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && e.target.value.length === 0 && index > 0) {
                        fields[index - 1].focus();
                    }
                });
            });
        }
        setupOtpAutoFocus('.otp-field');
        setupOtpAutoFocus('.reset-otp-field');

        // --- SIGN IN LOGIC ---
        async function handleSignin(e) {
            e.preventDefault();
            const email = document.getElementById('signin-email').value.trim();
            const password = document.getElementById('signin-password').value;
            const btn = document.getElementById('signin-btn');
            const originalText = btn.innerText;

            btn.innerText = "VERIFYING IDENTITY...";
            btn.disabled = true;

            try {
                const { data, error } = await _supabase.auth.signInWithPassword({ email, password });
                if (error) throw error;

                if (!data.user.email_confirmed_at) {
                    document.getElementById('pending-email').innerText = email;
                    toggleAuthMode('otp');
                    return;
                }

                // Check Role
                const { data: profile, error: profileErr } = await _supabase
                    .from('profiles')
                    .select('role')
                    .eq('id', data.user.id)
                    .single();

                if (profileErr) throw profileErr;
                const role = (profile.role || 'client').toLowerCase();
                window.location.href = role === 'admin' ? 'admin_dashboard.html' : 'client_dashboard.html';

            } catch (err) {
                console.error("Signin Error:", err);
                showAlert("Access Denied", err.message || "Invalid credentials provided.", 'error');
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        // --- CUSTOM OTT (SMTP) LOGIC ---
        let signupEmail = "";

        async function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const fullName = document.getElementById('signup-name').value;
            const mobile = iti.getNumber();
            const address = document.getElementById('signup-address').value;
            const age = document.getElementById('signup-age').value;
            const btn = document.getElementById('signup-btn');

            if (!iti.isValidNumber()) return alert("⚠️ Operation Halted: Invalid mobile number format.");

            btn.innerText = "SENDING CODE...";
            btn.disabled = true;

            try {
                signupEmail = email; // Store for verification/resend

                // Create user immediately. Supabase handles the "unconfirmed" state.
                const { data, error } = await _supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: fullName,
                            mobile: mobile,
                            address: address,
                            age: parseInt(age)
                        }
                    }
                });

                if (error) throw error;

                // Check if session was created immediately (auto-confirm enabled?)
                if (data.session) {
                    alert("✅ Account Verified! Redirecting...");
                    window.location.href = 'client_dashboard.html';
                    return;
                }

                // Show OTP input screen
                document.getElementById('pending-email').innerText = email;
                toggleAuthMode('otp');

                // Clear and focus OTP fields
                document.querySelectorAll('.otp-field').forEach(field => field.value = '');
                document.querySelector('.otp-field').focus();

            } catch (err) {
                console.error("Signup Error:", err);
                showAlert("Registration Failed", err.message, 'error');
            } finally {
                btn.innerText = "Initialize Account";
                btn.disabled = false;
            }
        }

        async function verifySignupOtp() {
            const enteredToken = Array.from(document.querySelectorAll('.otp-field')).map(i => i.value).join('');
            const btn = document.getElementById('otp-btn');

            // Robustly get email (variable or UI)
            if (!signupEmail) {
                const uiEmail = document.getElementById('pending-email').innerText;
                signupEmail = uiEmail ? uiEmail.trim() : "";
            }

            if (enteredToken.length < 6) return alert("⚠️ Input Error: 6-digit code required.");

            btn.innerText = "VERIFYING...";
            btn.disabled = true;

            try {
                // Attempt 1: Verify as Signup Confirmation
                let { data, error } = await _supabase.auth.verifyOtp({
                    email: signupEmail,
                    token: enteredToken,
                    type: 'signup'
                });

                // Attempt 2: If Signup fails, try Email (Magic Link/Login OTP)
                // This handles cases where the user state might be ambiguous or previously registered
                if (error) {
                    console.warn("Signup verification failed (" + error.message + "), attempting 'email' type...");
                    const secondAttempt = await _supabase.auth.verifyOtp({
                        email: signupEmail,
                        token: enteredToken,
                        type: 'email'
                    });

                    if (secondAttempt.error) {
                        // If both fail, throw the original error (or improved message)
                        console.error("Email verification also failed:", secondAttempt.error);
                        throw error;
                    }
                    // Success on second attempt
                    data = secondAttempt.data;
                    error = null;
                }

                if (error) throw error;

                // Success! Redirect.
                showAlert("Success!", "Account Verified! Redirecting to dashboard...", 'success');
                setTimeout(() => window.location.href = 'client_dashboard.html', 2000);

            } catch (err) {
                console.error("OTP Verification Error:", err);
                showAlert("Verification Failed", err.message + ". Please ensure you are entering the most recent code.", 'error');
            } finally {
                btn.innerText = "Confirm Verification";
                btn.disabled = false;
            }
        }

        async function resendSignupOtp() {
            const btn = document.querySelector('#view-otp button:last-child');
            const originalText = btn.innerText;
            btn.innerText = "Sending...";

            try {
                // Resend signup confirmation
                const { error } = await _supabase.auth.resend({
                    type: 'signup',
                    email: signupEmail
                });

                if (error) throw error;

                alert("✅ New code sent! Check your email.");
                document.querySelectorAll('.otp-field').forEach(field => field.value = '');
                document.querySelector('.otp-field').focus();

            } catch (e) {
                console.error("Resend Error:", e);
                alert("❌ Failed to resend: " + e.message);
            } finally {
                btn.innerText = originalText;
            }
        }

        function changeSignupEmail() {
            toggleAuthMode('signup');
            const btn = document.getElementById('signup-btn');
            btn.innerText = "Initialize Account";
            btn.disabled = false;
        }

        // --- FORGOT PASSWORD LOGIC ---
        async function handleForgotPassword(e) {
            e.preventDefault();
            const email = document.getElementById('forgot-email').value.trim();
            const btn = document.getElementById('forgot-btn');

            btn.innerText = "DISPATCHING RECOVERY...";
            btn.disabled = true;

            try {
                // Use Standard Supabase Reset (Semantic Recovery)
                // User MUST update their Supabase "Reset Password" Email Template to show {{ .Token }}
                const { error } = await _supabase.auth.resetPasswordForEmail(email);

                if (error) throw error;

                document.getElementById('pending-reset-email').innerText = email;
                toggleAuthMode('reset-otp');
                showAlert("Recovery Initiated", "Check your email for the recovery code.", 'success');
            } catch (err) {
                console.error("Reset Error:", err);
                showAlert("Recovery Failed", err.message, 'error');
            } finally {
                btn.innerText = "Begin Recovery";
                btn.disabled = false;
            }
        }

        async function verifyResetOtp() {
            const email = document.getElementById('pending-reset-email').innerText;
            const token = Array.from(document.querySelectorAll('.reset-otp-field')).map(i => i.value).join('');
            const btn = document.getElementById('reset-otp-btn');

            if (token.length < 6) return showAlert("Security Alert", "6-digit recovery code required.", 'error');

            btn.innerText = "ESTABLISHING SECURE CHANNEL...";
            btn.disabled = true;

            try {
                // Dual Verify Strategy: Try 'recovery' first, then 'email' fallback
                let { error } = await _supabase.auth.verifyOtp({ email, token, type: 'recovery' });

                if (error) {
                    console.log("Recovery type verification failed (" + error.message + "), trying 'email' type...");
                    const fallback = await _supabase.auth.verifyOtp({ email, token, type: 'email' });
                    if (fallback.error) {
                        throw fallback.error;
                    }
                }

                toggleAuthMode('update');
            } catch (err) {
                showAlert("Security Link Broken", err.message, 'error');
            } finally {
                btn.innerText = "Verify & Reset";
                btn.disabled = false;
            }
        }

        async function resendResetOtp() {
            const email = document.getElementById('pending-reset-email').innerText;
            const btn = document.getElementById('resend-reset-btn');
            const originalText = btn.innerText;

            btn.innerText = "SENDING NEW CODE...";
            btn.disabled = true;

            try {
                const { error } = await _supabase.auth.resetPasswordForEmail(email);
                if (error) throw error;

                showAlert("New Token Dispatched", "Check your email for the new code.", 'success');
            } catch (e) {
                showAlert("Failed to resend", e.message, 'error');
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        async function handleUpdatePassword(e) {
            e.preventDefault();
            const password = document.getElementById('update-password').value;
            const confirm = document.getElementById('update-password-confirm').value;
            const btn = document.getElementById('update-btn');

            if (password !== confirm) {
                return showAlert("Mismatch", "Passwords do not match.", "error");
            }
            if (password.length < 6) {
                return showAlert("Too Weak", "Password must be at least 6 characters.", "error");
            }

            btn.innerText = "APPLYING UPGRADE...";
            btn.disabled = true;

            try {
                const { error } = await _supabase.auth.updateUser({ password });
                if (error) throw error;

                showAlert("Security Upgrade Successful", "Login with your new password.", 'success');
                toggleAuthMode('signin');
            } catch (err) {
                showAlert("Upgrade Failed", err.message, 'error');
            } finally {
                btn.innerText = "Apply Changes";
                btn.disabled = false;
            }
        }

        // --- UI CORE ---
        function showView(id) {
            if (id === 'login') {
                document.getElementById('view-login').classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.getElementById('view-' + id).classList.add('active');
                document.body.style.overflow = 'auto';
                document.getElementById('view-login').classList.remove('active');

                // Reset all forms and state
                const forms = ['signup-form', 'forgot-password-form', 'update-password-form'];
                forms.forEach(fid => {
                    const f = document.getElementById(fid);
                    if (f) f.reset();
                });
                const signinForm = document.querySelector('#form-signin form');
                if (signinForm) signinForm.reset();

                document.querySelectorAll('.otp-field, .reset-otp-field').forEach(i => i.value = '');
                toggleAuthMode('signin');
            }
        }

        function toggleAuthMode(mode) {
            const modes = ['signin', 'signup', 'forgot', 'otp', 'reset-otp', 'update'];
            modes.forEach(m => document.getElementById(`form-${m}`)?.classList.add('hidden'));
            document.getElementById('view-otp').classList.add('hidden');
            document.getElementById('view-reset-otp').classList.add('hidden');

            if (mode === 'otp') document.getElementById('view-otp').classList.remove('hidden');
            else if (mode === 'reset-otp') document.getElementById('view-reset-otp').classList.remove('hidden');
            else document.getElementById(`form-${mode}`).classList.remove('hidden');
        }

        function openLightbox(src) {
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox-modal').classList.add('active');
        }

        function closeLightbox() {
            document.getElementById('lightbox-modal').classList.remove('active');
        }

        function togglePasswordVisibility(id) {
            const input = document.getElementById(id);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // --- DATA HUB ---
        async function fetchPublicReviews() {
            const container = document.getElementById('testimonials-container');
            const { data, error } = await _supabase
                .from('reviews')
                .select('*, profiles:client_id(full_name)')
                .eq('is_public', true)
                .order('created_at', { ascending: false })
                .limit(6);

            if (error) {
                container.innerHTML = `<p class="col-span-3 text-slate-400 font-bold uppercase text-xs">Error loading insights.</p>`;
                return;
            }

            if (data.length === 0) {
                container.innerHTML = `<div class="bg-slate-50 p-8 rounded-[32px] border border-slate-200 border-dashed flex flex-col items-center justify-center text-center col-span-3 py-20 grayscale opacity-60">
                    <i class="fa-solid fa-star-half-stroke text-4xl text-slate-300 mb-6"></i>
                    <h3 class="font-black text-slate-400 uppercase tracking-widest text-sm mb-2">Awaiting Verified Feedbacks</h3>
                    <p class="text-slate-400 text-xs font-bold uppercase tracking-widest leading-relaxed">Once reviews are approved, they will appear here.</p>
                </div>`;
                return;
            }

            container.innerHTML = data.map(r => `
                <div class="bg-slate-50 p-8 rounded-[32px] border border-slate-100 shadow-sm transition-all hover:shadow-xl hover:-translate-y-1 flex flex-col group">
                    <div class="flex items-center gap-1 text-amber-400 mb-6 group-hover:scale-105 transition-transform origin-left">
                        ${'<i class="fa-solid fa-star"></i>'.repeat(r.rating)}${'<i class="fa-regular fa-star text-slate-300"></i>'.repeat(5 - r.rating)}
                    </div>
                    <p class="text-slate-600 italic mb-8 text-sm leading-relaxed flex-grow">"${r.comment || 'Performance beyond expectations.'}"</p>
                    <div class="flex items-center gap-3 mt-auto pt-6 border-t border-slate-200/60">
                        <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-black text-xs shadow-lg shadow-blue-500/20">
                            ${(r.profiles?.full_name || 'V').charAt(0)}
                        </div>
                        <div>
                            <p class="font-black text-[10px] uppercase tracking-widest text-slate-800">${r.profiles?.full_name || 'Valued Client'}</p>
                            <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest mt-0.5">Verified Experience</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        let currentPage = 1;
        const imagesPerPage = 8;
        let dynamicProjects = [];

        async function fetchDynamicPortfolio() {
            const { data, error } = await _supabase
                .from('reviews')
                .select('photo_urls, rating, comment, profiles:client_id(full_name)')
                .eq('is_public', true);

            if (!error && data) {
                dynamicProjects = data.flatMap(r => {
                    let urls = [];
                    try {
                        urls = JSON.parse(r.photo_urls || '[]');
                    } catch (e) {
                        if (r.photo_urls) urls = [r.photo_urls];
                    }
                    return urls.map(url => ({
                        img: url,
                        client: r.profiles?.full_name || 'Private Client',
                        rating: r.rating,
                        comment: r.comment
                    }));
                });
            }

            // Fallback to static if empty to populate the gallery
            const staticPhotos = [
                'image/1.jpg', 'image/2.jpg', 'image/3.jpg', 'image/4.jpg',
                'image/5.jpg', 'image/6.jpg', 'image/7.jpg', 'image/8.jpg',
                'image/9.jpg', 'image/10.jpg', 'image/11.jpg', 'image/12.jpg',
                'image/13.jpg', 'image/14.jpg', 'image/15.jpg', 'image/16.jpg'
            ];

            staticPhotos.forEach(img => {
                // We add static photos as fallback to ensure the gallery is always full
                dynamicProjects.push({
                    img,
                    client: 'Verified Project',
                    rating: 5,
                    comment: 'High-quality professional transformation.'
                });
            });

            renderProjects();
        }

        function renderProjects() {
            const container = document.getElementById('project-container');
            const pagination = document.getElementById('project-pagination');
            if (!container) return;
            container.innerHTML = '';
            pagination.innerHTML = '';

            const start = (currentPage - 1) * imagesPerPage;
            const currentProjects = dynamicProjects.slice(start, start + imagesPerPage);

            currentProjects.forEach((proj, idx) => {
                const isVideo = proj.img.toLowerCase().match(/\.(mp4|mov|webm|ogg|m4v)$/) || proj.img.includes('/video/upload/');
                const div = document.createElement('div');
                div.className = "group relative aspect-square overflow-hidden rounded-[32px] bg-slate-200 cursor-pointer shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-2";
                div.setAttribute('data-aos', 'fade-up');
                div.setAttribute('data-aos-delay', idx * 100);

                let mediaHtml = `<img src="${proj.img}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />`;
                if (isVideo) {
                    mediaHtml = `
                        <video src="${proj.img}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" muted loop playsinline></video>
                        <div class="absolute top-4 right-4 w-8 h-8 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white text-xs">
                            <i class="fa-solid fa-play"></i>
                        </div>
                    `;
                }

                div.innerHTML = `
                    ${mediaHtml}
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/20 to-transparent opacity-0 group-hover:opacity-100 transition-all duration-500 flex flex-col justify-end p-8">
                        <div class="flex gap-1 text-amber-400 text-[8px] mb-2">
                             ${'<i class="fa-solid fa-star"></i>'.repeat(proj.rating)}
                        </div>
                        <span class="text-blue-400 font-black text-[10px] uppercase tracking-widest mb-1">Project by ${proj.client}</span>
                        <h4 class="text-white font-medium text-xs leading-relaxed line-clamp-2 italic">"${proj.comment}"</h4>
                    </div>
                `;
                div.onclick = () => openLightbox(proj.img);
                container.appendChild(div);
            });

            const totalPages = Math.ceil(dynamicProjects.length / imagesPerPage);
            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = `pagination-btn ${currentPage === i ? 'active' : ''}`;
                btn.innerText = i;
                btn.onclick = () => { currentPage = i; renderProjects(); };
                pagination.appendChild(btn);
            }
        }

        async function checkSession() {
            // Check if we are handling a Recovery/Magic Link
            const hash = window.location.hash;
            const isRecovery = hash && (hash.includes('type=recovery') || hash.includes('type=magiclink') || hash.includes('access_token'));

            // If it's a normal visit (no link), sign out to force manual credentials (as per policy)
            const { data: { session } } = await _supabase.auth.getSession();
            if (session && !isRecovery) {
                console.log("Clearing persistent session (Force Login Mode)");
                await _supabase.auth.signOut();
            } else if (isRecovery) {
                console.log("Recovery Link Detected. Preserving session.");
                // If it is specifically a recovery link, show update form
                if (hash.includes('type=recovery')) {
                    setTimeout(() => toggleAuthMode('update'), 500); // Small delay to let Supabase process
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchDynamicPortfolio();
            fetchPublicReviews();
            checkSession();
            AOS.init({ duration: 1000, once: true });

            // Listen for Auth Events (specifically Recovery)
            _supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'PASSWORD_RECOVERY') {
                    toggleAuthMode('update');
                    showAlert("Identity Verified", "Please set your new password.", "success");
                }
            });
        });
    </script>

</body>

</html>